<html>
  <head>
    <title>Stitch Design</title>
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64," />
    <link rel="stylesheet" href="assets/css/font-awesome.all.min.css" />
    <link rel="stylesheet" href="assets/css/fonts.css" />
    <link rel="stylesheet" href="assets/css/choices.min.css" />
    <link href="assets/css/litepicker.css" rel="stylesheet" />
    <script src="assets/js/litepicker.js"></script>
    <script src="assets/js/choices.min.js"></script>
    <script src="assets/js/tailwindcss.js"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            transitionProperty: {
              'width-opacity': 'width, opacity, margin'
            }
          }
        }
      }
    </script>
    <script src="assets/js/dayjs.min.js"></script>
  </head>
  <body>
    <div class="relative flex size-full min-h-screen flex-col bg-gray-50 group/design-root overflow-x-hidden" style='font-family: Inter, "Noto Sans", sans-serif;'>
      <div class="layout-container flex h-full grow flex-col">
        <header class="sticky top-0 z-50 bg-gray-50 flex items-center justify-between whitespace-nowrap border-b border-solid border-b-[#eaedf1] px-3 py-3">
          <div class="flex items-center gap-8">
            <div class="flex items-center gap-4 text-[#101518]">
              <button id="sidebarToggle" class="text-[#5c748a] hover:text-[#101518] text-xl px-2 py-1 rounded-md">
                <i class="fa-solid fa-bars"></i>
              </button>
              <div class="size-4">
                <i class="fa-solid fa-chart-pie"></i>
              </div>
              <h2 class="text-[#101518] text-lg font-bold leading-tight tracking-[-0.015em]">Data Insights</h2>
            </div>
            <div class="flex items-center gap-9">
              <a class="text-[#101518] text-sm font-medium leading-normal" href="#">Home</a>
              <a class="text-[#101518] text-sm font-medium leading-normal" href="#">Reports</a>
              <a class="text-[#101518] text-sm font-medium leading-normal" href="#">Analytics</a>
              <a class="text-[#101518] text-sm font-medium leading-normal" href="#">Settings</a>
            </div>
          </div>
          <div class="flex flex-1 justify-end gap-8">
            <label class="flex flex-col min-w-40 !h-10 max-w-64">
              <div class="flex w-full flex-1 items-stretch rounded-xl h-full">
                <div class="text-[#5c748a] flex border-none bg-[#eaedf1] items-center justify-center pl-4 rounded-l-xl border-r-0">
                  <i class="fa-solid fa-magnifying-glass"></i>
                </div>
                <input
                  placeholder="Search"
                  class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#101518] focus:outline-0 focus:ring-0 border-none bg-[#eaedf1] focus:border-none h-full placeholder:text-[#5c748a] px-4 rounded-l-none border-l-0 pl-2 text-base font-normal leading-normal"
                  value=""
                />
              </div>
            </label>
            <div class="flex items-center justify-center rounded-full size-10 bg-[#eaedf1]">
              <i class="fa-solid fa-user" style="font-size: 24px; color: #101518;"></i>
            </div>
          </div>
        </header>
        <div id="contentWrapper" class="flex flex-1 py-5 transition-all duration-300 ease-in-out overflow-y-auto h-[calc(100vh-64px)]">
          <div id="sidebar" class="fixed top-[64px] z-40 bg-gray-50 layout-content-container flex flex-col w-60 opacity-100 transition-width-opacity duration-300 ease-in-out">
            <div class="flex h-full min-h-[700px] flex-col justify-between bg-gray-50 p-4">
              <div class="flex flex-col gap-4">
                <div class="flex flex-col gap-2">
                  <div class="flex items-center gap-3 px-3 py-2 rounded-xl bg-[#eaedf1]">
                    <div class="text-[#101518]">
                      <i class="fa-solid fa-house"></i>
                    </div>
                    <p class="text-[#101518] text-sm font-medium leading-normal">Home</p>
                  </div>
                  <div class="flex items-center gap-3 px-3 py-2">
                    <div class="text-[#101518]">
                      <i class="fa-solid fa-file-lines"></i>
                    </div>
                    <p class="text-[#101518] text-sm font-medium leading-normal">Reports</p>
                  </div>
                  <div class="flex items-center gap-3 px-3 py-2">
                    <div class="text-[#101518]">
                      <i class="fa-solid fa-chart-line"></i>
                    </div>
                    <p class="text-[#101518] text-sm font-medium leading-normal">Analytics</p>
                  </div>
                  <div class="flex items-center gap-3 px-3 py-2">
                    <div class="text-[#101518]">
                      <i class="fa-solid fa-gear"></i>
                    </div>
                    <p class="text-[#101518] text-sm font-medium leading-normal">Settings</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div id="main-content" class="layout-content-container flex flex-col flex-1 transition-all duration-300 ease-in-out ml-60">
            <!-- pages insert di sini -->
          </div>
        </div>
      </div>
    </div>

    <script src="assets/js/jquery-3.7.1.min.js"></script>
    <script>
      $(document).ready(function () {
        const $sidebar = $('#sidebar .gap-2');
        const $mainContent = $('#main-content');

        // 🚀 載入 sidebar JSON
        $.getJSON('sidebar-menu.json', function (menuItems) {
          $sidebar.empty();

          $.each(menuItems, function (index, item) {
            const $menuItem = $(`
              <div class="flex items-center gap-3 px-3 py-2 cursor-pointer hover:bg-[#eaedf1] rounded-xl" data-html="${item.html}">
                <div class="text-[#101518]"><i class="fa-solid ${item.icon}"></i></div>
                <p class="text-[#101518] text-sm font-medium leading-normal">${item.label}</p>
              </div>
            `);

            $menuItem.on('click', function () {
              const htmlPath = $(this).data('html');
              $mainContent.load(htmlPath, function (response, status, xhr) {
                if (status === "error") {
                  $mainContent.html(`<div class="p-6 text-red-500">載入失敗：${xhr.status} ${xhr.statusText}</div>`);
                }
              });

              // 樣式控制：active
              $sidebar.find('div').removeClass('bg-[#eaedf1]');
              $(this).addClass('bg-[#eaedf1]');
            });

            $sidebar.append($menuItem);
          });

          // 預設載入第一項
          if (menuItems.length > 0) {
            $sidebar.find('div').first().trigger('click');
          }
        });

        // 📦 Sidebar 展開 / 收合
        const $sidebarToggle = $('#sidebarToggle');
        const $sidebarPanel = $('#sidebar');

        // Enhance: smooth sidebar animation and stable layout
        $sidebarToggle.on('click', function () {
          const isOpen = $sidebarPanel.hasClass('w-60');

          if (isOpen) {
            // collapse
            $sidebarPanel.removeClass('w-60 opacity-100').addClass('w-0 opacity-0 overflow-hidden');
            $mainContent.css('margin-left', '0');
          } else {
            // expand
            $sidebarPanel.removeClass('w-0 opacity-0 overflow-hidden').addClass('w-60 opacity-100');

            // 檢查右側 detail 視窗是否開啟，若開啟則關閉
            const $detailDrawer = $('#project-detail-drawer');
            if ($detailDrawer.length && !$detailDrawer.hasClass('hidden')) {
              $detailDrawer.addClass('hidden');
              $detailDrawer.css('display', 'none');
            }
            $mainContent.css('margin-left', '15rem');
          }
        });
      });

    </script>
  </body>
</html>
